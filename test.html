<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FM Transceiver | Denys Shlyakhtovskyy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/style.css">

  <style>
    body{
      background:#fff;
      color:#000;
    }

    /* make sure your global styles don't force dark cards */
    .container{
      background: transparent;
    }

    /* ===== stats table (fix borders for white bg) ===== */
    .stats-table{
      width: 100%;
      max-width: 70ch;
      margin: 0 auto;
      border-collapse: collapse;
      text-align: left;
    }
    .stats-table th,
    .stats-table td{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(0,0,0,0.12); /* <-- was white */
      vertical-align: top;
    }
    .stats-table th{
      width: 42%;
      font-weight: 600;
      opacity: 0.9;
    }
    .stats-table td{
      opacity: 0.95;
    }

    .schematics-list{
      text-align:center;
      margin-top:8px;
    }
    .schematics-list .section-link{
      display:block;
      width:100%;
      margin:14px 0 8px 0;
    }
    .schematics-list .drop-panel{
      text-align:center;
      margin:0 auto 8px auto;
      max-width:70ch;
    }
    .schematics-list .drop-panel img{ margin:0 auto; }
    .schematics-list .drop-panel p{
      text-align:center;
      margin-top:10px;
    }

    /* stack top-level headers vertically (NO IDs) */
    .top-link{
      display:block;
      width:fit-content;
      margin:14px 0 8px 0;
    }

    /* ===== subsystem map ===== */
    .map-wrap{
      position:relative;
      width:100%;
      max-width:900px;
      margin:18px auto 10px;
    }
    .map-wrap img{
      width:100%;
      height:auto;
      display:block;
      border-radius:10px;
    }
    .map-overlay{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
    }

    .hot{
      fill: rgba(0,0,0,0);
      stroke: rgba(0,0,0,0);
      stroke-width: 3;
      cursor:pointer;
      transition: fill 180ms ease, stroke 180ms ease;
    }
    .hot:hover{ stroke: rgba(0,0,0,0.18); }
    .hot.is-active{ stroke: rgba(0,0,0,0.25); }

    .hot-red:hover, .hot-red.is-active{ fill: rgba(255,0,0,0.14); stroke: rgba(255,0,0,0.55); }
    .hot-blue:hover, .hot-blue.is-active{ fill: rgba(0,90,255,0.14); stroke: rgba(0,90,255,0.55); }
    .hot-cyan:hover, .hot-cyan.is-active{ fill: rgba(0,200,220,0.14); stroke: rgba(0,200,220,0.55); }
    .hot-black:hover, .hot-black.is-active{ fill: rgba(0,0,0,0.10); stroke: rgba(0,0,0,0.55); }
    .hot-audio:hover, .hot-audio.is-active{ fill: rgba(120,120,120,0.18); stroke: rgba(120,120,120,0.70); }
    .hot-uc:hover, .hot-uc.is-active{ fill: rgba(60,60,60,0.22); stroke: rgba(60,60,60,0.80); }
    .hot-magenta:hover, .hot-magenta.is-active{ fill: rgba(255,0,255,0.12); stroke: rgba(255,0,255,0.55); }

    .map-panels{
      max-width:900px;
      margin:0 auto;
    }
    .map-panels h3{ margin:12px 0 6px; }

    /* ===== lens zoom (base) ===== */
    .zoom-wrap{
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }
    .zoom-img{
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
    }
    .zoom-lens{
      position:absolute;
      left:0; top:0;
      width:220px;
      height:220px;
      border:2px solid #000;
      border-radius:14px;
      background-repeat:no-repeat;
      background-color:#fff;
      pointer-events:none;
      opacity:0;
      transform:translate(-9999px,-9999px);
      transition: opacity 120ms ease;
    }
    .zoom-wrap:hover .zoom-lens{ opacity:1; }

    /* ===== hardware image grid (FIXED) ===== */
    .hw-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      width: 100%;
      max-width: none; /* fill dropdown width */
      margin: 0;
    }
    @media (max-width: 900px){
      .hw-grid{ grid-template-columns: 1fr; }
    }

    .hw-card{
      width:100%;
      margin:0;
    }

    /* force same visible size, NO grey, NO clipping from container */
    .hw-card .zoom-wrap{
      max-width: none;
      margin: 0;
    }

    /* IMPORTANT: remove rounded corners + remove "grey field" */
    .hw-card .zoom-img{
      width:100%;
      height: 460px;        /* bigger */
      object-fit: contain;  /* shows whole PCB (no cropping) */
      background: transparent; /* no grey field */
      border-radius: 0;     /* no rounded corners */
    }

    /* lens also square for hardware section */
    .hw-card .zoom-lens{
      border-radius: 0;
    }

    .hw-cap{
      margin-top: 10px;
      text-align:center;
      font-weight: 500;
    }
  </style>
</head>

<body>
  <div class="container">
    <a class="back" href="/projects/">← Back to Projects</a>
    <h1>FM Transceiver</h1>

    <p>
      This project was made for the Electronics Engineering program at Okanagan College in 2022.
      The idea was to integrate digital control architecture with RF components to create a low power
      2-way FM radio (pair of walkie talkies); Below is a technical description of the project.
    </p>

    <hr>

    <!-- ========================= TOP-LEVEL DROPDOWNS ========================= -->

    <!-- Quick Stats -->
    <section class="drop" data-drop>
      <a class="section-link top-link" href="#" data-drop-btn>Quick Stats</a>
      <div class="drop-panel" hidden aria-hidden="true" data-drop-panel>
        <div class="drop-inner">
          <div class="schematics-list">
            <table class="stats-table">
              <tbody>
                <tr><th>Project</th><td>FM Transceiver Pair (two devices)</td></tr>
                <tr><th>Program / Year</th><td>Electronic Engineering Technology, 2022 (Okanagan College)</td></tr>
                <tr><th>Modulation</th><td>FM (Frequency Modulation)</td></tr>
                <tr><th>Target Range</th><td>10 m (indoor short-range)</td></tr>
                <tr><th>Battery</th><td>Single 18650 Li-ion (3000 mAh)</td></tr>
                <tr><th>Standby Time (spec)</th><td>3 hours</td></tr>
                <tr><th>Continuous TX Time (spec)</th><td>30 minutes</td></tr>
                <tr><th>MCU</th><td>Microchip PIC24FJ1024GB606</td></tr>
                <tr><th>RF Transceiver</th><td>Silicon Labs SI4720 (76–108 MHz band)</td></tr>
                <tr><th>Audio Output</th><td>8 Ω speaker + TI TPA321 amplifier (BTL)</td></tr>
                <tr><th>Display</th><td>1.3&quot; SPI GLCD (Adafruit 4313, 240×240, ST7789 controller)</td></tr>
                <tr><th>Battery Protection</th><td>TI BQ77905 (“BATMAN”) + NTC + dual MOSFET cutoff</td></tr>
                <tr><th>Battery Monitoring</th><td>MCP3021 (10-bit I²C ADC) + buffer stage</td></tr>
                <tr><th>Status</th><td>Not fully functional (SPI timing/transfer issues prevented control of SI4720 + GLCD)</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Hardware Implementation -->
    <section class="drop" data-drop>
      <a class="section-link top-link" href="#" data-drop-btn>Hardware Implementation</a>
      <div class="drop-panel" hidden aria-hidden="true" data-drop-panel>
        <div class="drop-inner">

          <div class="hw-grid">
            <div class="hw-card">
              <div class="zoom-wrap" data-zoom="2.0" data-lens="220">
                <img class="zoom-img" src="/assets/photos/fm/pcb-front.png" alt="PCB front" />
                <div class="zoom-lens" aria-hidden="true"></div>
              </div>
              <div class="hw-cap">Front</div>
            </div>

            <div class="hw-card">
              <div class="zoom-wrap" data-zoom="2.0" data-lens="220">
                <img class="zoom-img" src="/assets/photos/fm/pcb-rear.png" alt="PCB rear" />
                <div class="zoom-lens" aria-hidden="true"></div>
              </div>
              <div class="hw-cap">Rear</div>
            </div>
          </div>

          <p>
            The PCB was designed with functional partitioning and signal-integrity considerations in mind. Components are grouped by subsystem
            (MCU support, RF front-end, audio, and power management) to keep routing intuitive and minimize trace length for critical signals.
          </p>

        </div>
      </div>
    </section>

    <!-- Control -->
    <section class="drop" data-drop>
      <a class="section-link top-link" href="#" data-drop-btn>Control</a>
      <div class="drop-panel" hidden aria-hidden="true" data-drop-panel>
        <div class="drop-inner">
          <div class="zoom-wrap" data-zoom="2.0" data-lens="220">
            <img class="zoom-img" src="/assets/photos/fm/soft-flow.png" alt="Software block diagram" />
            <div class="zoom-lens" aria-hidden="true"></div>
          </div>
          <p>...</p>
        </div>
      </div>
    </section>

    <!-- Form & Enclosure (FIXED CLOSING TAGS) -->
    <section class="drop" data-drop>
      <a class="section-link top-link" href="#" data-drop-btn>Form &amp; Enclosure</a>
      <div class="drop-panel" hidden aria-hidden="true" data-drop-panel>
        <div class="drop-inner">
          <div style="text-align:center; margin:20px 0;">
            <img src="/assets/photos/fm/physical.png" alt="FM Transceiver PCB" style="max-width:100%; height:auto;">
          </div>
          <p>Physical assembled prototype.</p>
          <p>Fusion 360 enclosure design.</p>
        </div>
      </div>
    </section>

    <!-- Skills -->
    <section class="drop" data-drop>
      <a class="section-link top-link" href="#" data-drop-btn>Skills and Outcomes</a>
      <div class="drop-panel" hidden aria-hidden="true" data-drop-panel>
        <div class="drop-inner">
          <p>Add your skills/outcomes content here.</p>
        </div>
      </div>
    </section>

    <script>
      // ===== helpers (ONLY ONCE) =====
      function shiftToViewportCenter(el){
        const r = el.getBoundingClientRect();
        const elCenter = r.left + r.width / 2;
        const viewportCenter = window.innerWidth / 2;
        return viewportCenter - elCenter;
      }
      function waitForTransition(el, prop){
        return new Promise((resolve) => {
          const onEnd = (e) => {
            if (e.propertyName !== prop) return;
            el.removeEventListener("transitionend", onEnd);
            resolve();
          };
          el.addEventListener("transitionend", onEnd);
        });
      }
      async function openPanel(panel){
        panel.hidden = false;
        panel.setAttribute("aria-hidden", "false");
        panel.style.maxHeight = "0px";
        panel.getBoundingClientRect();
        panel.classList.add("is-open");
        panel.style.maxHeight = panel.scrollHeight + "px";
        await waitForTransition(panel, "max-height");
        panel.style.maxHeight = "none";
      }
      async function closePanel(panel){
        panel.style.maxHeight = panel.scrollHeight + "px";
        panel.getBoundingClientRect();
        panel.classList.remove("is-open");
        panel.style.maxHeight = "0px";
        await waitForTransition(panel, "max-height");
        panel.hidden = true;
        panel.setAttribute("aria-hidden", "true");
      }
      function hardCloseInside(root){
        root.querySelectorAll(".drop-panel").forEach((p) => {
          p.classList.remove("is-open");
          p.style.maxHeight = "0px";
          p.hidden = true;
          p.setAttribute("aria-hidden", "true");
        });
        root.querySelectorAll(".section-link").forEach((a) => a.classList.remove("is-selected"));
      }

      // ===== Generic dropdowns =====
      document.querySelectorAll("[data-drop]").forEach((drop) => {
        const topBtn = drop.querySelector("[data-drop-btn]");
        const topPanel = drop.querySelector("[data-drop-panel]");
        if (!topBtn || !topPanel) return;

        let open = false;
        let sliding = false;

        async function slideToCenter(){
          if (sliding) return;
          sliding = true;
          topBtn.style.transform = "translateX(0px)";
          topBtn.getBoundingClientRect();
          requestAnimationFrame(() => {
            topBtn.style.transform = `translateX(${shiftToViewportCenter(topBtn)}px)`;
          });
          await waitForTransition(topBtn, "transform");
          sliding = false;
        }
        async function slideBackLeft(){
          if (sliding) return;
          sliding = true;
          topBtn.style.transform = "translateX(0px)";
          await waitForTransition(topBtn, "transform");
          sliding = false;
        }

        topBtn.addEventListener("click", async (e) => {
          e.preventDefault();
          if (sliding) return;
          open = !open;

          if (open){
            topBtn.classList.add("is-selected");
            await slideToCenter();
            await openPanel(topPanel);
          } else {
            hardCloseInside(topPanel);
            await closePanel(topPanel);
            topBtn.classList.remove("is-selected");
            await slideBackLeft();
          }
        });

        window.addEventListener("resize", () => {
          if (open){
            topBtn.style.transform = `translateX(${shiftToViewportCenter(topBtn)}px)`;
            if (!topPanel.hidden && topPanel.style.maxHeight !== "none"){
              topPanel.style.maxHeight = topPanel.scrollHeight + "px";
            }
          }
        });
      });

      // ===== Lens zoom (same as yours) =====
      (function setupLensZoom(){
        document.querySelectorAll(".zoom-wrap").forEach((wrap) => {
          const img = wrap.querySelector(".zoom-img");
          const lens = wrap.querySelector(".zoom-lens");
          if (!img || !lens) return;

          const getNum = (attr, fallback) => {
            const v = Number(wrap.dataset[attr]);
            return Number.isFinite(v) ? v : fallback;
          };

          function syncLensSize(){
            const s = getNum("lens", 220);
            lens.style.width = s + "px";
            lens.style.height = s + "px";
            return s;
          }

          function updateBackground(){
            const r = img.getBoundingClientRect();
            const zoom = getNum("zoom", 2.0);
            lens.style.backgroundImage = `url(${img.src})`;
            lens.style.backgroundSize = `${r.width * zoom}px ${r.height * zoom}px`;
            return { r, zoom };
          }

          function setPos(e){
            const { r, zoom } = updateBackground();
            const lensSize = syncLensSize();
            const half = lensSize / 2;

            let x = e.clientX - r.left;
            let y = e.clientY - r.top;

            x = Math.max(0, Math.min(x, r.width));
            y = Math.max(0, Math.min(y, r.height));

            lens.style.transform = `translate(${x - half}px, ${y - half}px)`;
            lens.style.backgroundPosition = `${-x * zoom + half}px ${-y * zoom + half}px`;
          }

          function onEnter(){
            syncLensSize();
            updateBackground();
            lens.style.opacity = "1";
          }
          function onLeave(){
            lens.style.opacity = "0";
            lens.style.transform = "translate(-9999px, -9999px)";
          }

          wrap.addEventListener("mouseenter", onEnter);
          wrap.addEventListener("mousemove", setPos);
          wrap.addEventListener("mouseleave", onLeave);
          window.addEventListener("resize", () => {
            if (lens.style.opacity === "1") updateBackground();
          });
        });
      })();
    </script>
  </div>
</body>
</html>
