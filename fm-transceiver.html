<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FM Transceiver | Denys Shlyakhtovskyy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css">

  <!-- minimal page-only layout helpers (no global changes) -->
  <style>
    .schematics-list{
      text-align: center;
      margin-top: 8px;
    }
    .schematics-list .section-link{
      display: block;
      width: 100%;
      margin: 14px 0 8px 0; /* vertical rhythm */
    }
    .schematics-list .drop-panel{
      text-align: center;   /* image + text centered */
      margin: 0 auto 8px auto;
      max-width: 70ch;
    }
    .schematics-list .drop-panel img{
      margin: 0 auto;       /* center image */
    }
    .schematics-list .drop-panel p{
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- Back button aligned with container padding/width -->
    <a class="back" href="./projects.html">← Back to Projects</a>

    <h1>FM Transceiver</h1>

    <p>
      This project is a portable two-way FM transceiver designed for short-range indoor communication using a modular, safety-focused architecture. Each unit is powered by a removable 18650 Li-ion cell and incorporates a dedicated battery management system to ensure safe operation under all load and fault conditions. A central microcontroller coordinates user input, display output, RF configuration, and power behavior using interrupt-driven control and serial interfaces. Wireless transmission and reception are handled by a monolithic FM transceiver IC, reducing RF design complexity while maintaining stable and noise-resistant communication. Audio is captured through an electret microphone, processed by the transceiver, and amplified to drive an onboard speaker. The system is organized into clearly defined functional blocks—power, control, RF, audio, and user interface—to improve reliability, simplify debugging, and support future iteration.
    </p>

    <hr>

    <!-- Main header button -->
    <a class="section-link" id="schematicsLink" href="#">Schematics</a>

    <!-- Main dropdown content -->
    <div id="schematicsPanel" class="drop-panel" hidden aria-hidden="true">
      <div class="drop-inner">

        <div class="schematics-list">
          <!-- 1 -->
          <a class="section-link" href="#" data-dd="battery-management">Battery management</a>
          <div class="drop-panel" id="dd-battery-management" hidden aria-hidden="true">
            <div class="drop-inner">
              <img src="assets/photos/fm/battery-management.png" alt="Battery management schematic">
              <p>The BATMAN battery management subsystem for the FM Transceiver project and is centered
                around the Texas Instruments BQ77905 battery manager IC. 
                Its primary function is to safely manage a single 18650 
                Li-ion cell by providing over-voltage, under-voltage, 
                over-current, short-circuit, and temperature protection. 
                The BATMAN IC continuously monitors cell voltage, 
                charge/discharge current through a sense resistor, and cell 
                temperature via an external NTC thermistor. 
                Two external MOSFETs are driven by BATMAN to disconnect 
                the battery from the system load when unsafe conditions 
                are detected. Status outputs such as CHG, DSG, and LD provide 
                the system controller with real-time 
                information about battery and load state. 
                In the broader scope of the project, this subsystem forms the core of the power supply block, 
                ensuring user safety and protecting all downstream electronics. By isolating fault 
                conditions at the battery level, BATMAN improves overall system reliability 
                and allows the FM transceiver to operate safely from a removable high-energy Li-ion cell.
              </p>
            </div>
          </div>

          <!-- 2 -->
          <a class="section-link" href="#" data-dd="voltage-regulator">Voltage regulator</a>
          <div class="drop-panel" id="dd-voltage-regulator" hidden aria-hidden="true">
            <div class="drop-inner">
              <img src="assets/photos/fm/voltage-regulator.png" alt="Voltage regulator schematic">
              <p>The S-1172 voltage regulator stage used to condition battery power for the rest of the system. 
                The regulator takes the protected battery output (PREBAT) and produces a stable, 
                regulated supply rail for sensitive electronics downstream. Input and output capacitors are 
                placed close to the device to ensure stability, suppress noise, and handle transient current demands. 
                The ON/OFF pin allows the regulator to be cleanly enabled or disabled as part of the system power-up sequence. 
                By regulating the inherently variable voltage of an 18650 Li-ion cell, this stage prevents brownouts 
                and over-voltage stress on digital and RF components. In the broader scope of the project, 
                this schematic sits directly after the BATMAN battery manager and acts as the final power conditioning 
                step. Together, these blocks ensure the transceiver operates reliably across the full battery discharge curve.
              </p>
            </div>
          </div>

          <!-- keep the rest exactly as you already have it -->
          <!-- ... (no other changes below this line) ... -->

        </div>
      </div>
    </div>

    <script>
      function shiftToViewportCenter(el){
        const r = el.getBoundingClientRect();
        const elCenter = r.left + r.width / 2;
        const viewportCenter = window.innerWidth / 2;
        return viewportCenter - elCenter;
      }

      function waitForTransition(el, prop){
        return new Promise((resolve) => {
          const onEnd = (e) => {
            if (e.propertyName !== prop) return;
            el.removeEventListener("transitionend", onEnd);
            resolve();
          };
          el.addEventListener("transitionend", onEnd);
        });
      }

      async function openPanel(panel){
        panel.hidden = false;
        panel.setAttribute("aria-hidden", "false");

        panel.style.maxHeight = "0px";
        panel.getBoundingClientRect();

        panel.classList.add("is-open");
        panel.style.maxHeight = panel.scrollHeight + "px";

        await waitForTransition(panel, "max-height");
        panel.style.maxHeight = "none";
      }

      async function closePanel(panel){
        panel.style.maxHeight = panel.scrollHeight + "px";
        panel.getBoundingClientRect();

        panel.classList.remove("is-open");
        panel.style.maxHeight = "0px";

        await waitForTransition(panel, "max-height");

        panel.hidden = true;
        panel.setAttribute("aria-hidden", "true");
      }

      const schematicsLink = document.getElementById("schematicsLink");
      const schematicsPanel = document.getElementById("schematicsPanel");

      let schematicsOpen = false;
      let sliding = false;

      async function slideToCenter(){
        if (sliding) return;
        sliding = true;

        schematicsLink.style.transform = "translateX(0px)";
        schematicsLink.getBoundingClientRect();

        requestAnimationFrame(() => {
          const shift = shiftToViewportCenter(schematicsLink);
          schematicsLink.style.transform = `translateX(${shift}px)`;
        });

        await waitForTransition(schematicsLink, "transform");
        sliding = false;
      }

      async function slideBackLeft(){
        if (sliding) return;
        sliding = true;

        schematicsLink.style.transform = "translateX(0px)";
        await waitForTransition(schematicsLink, "transform");

        sliding = false;
      }

      schematicsLink.addEventListener("click", async (e) => {
        e.preventDefault();
        if (sliding) return;

        schematicsOpen = !schematicsOpen;

        if (schematicsOpen) {
          schematicsLink.classList.add("is-selected");
          await slideToCenter();
          await openPanel(schematicsPanel);
        } else {
          document.querySelectorAll(".schematics-list .drop-panel").forEach((p) => {
            p.classList.remove("is-open");
            p.style.maxHeight = "0px";
            p.hidden = true;
            p.setAttribute("aria-hidden", "true");
          });
          document.querySelectorAll(".schematics-list .section-link").forEach((a) => {
            a.classList.remove("is-selected");
          });

          await closePanel(schematicsPanel);
          schematicsLink.classList.remove("is-selected");
          await slideBackLeft();
        }
      });

      window.addEventListener("resize", () => {
        if (!schematicsOpen) return;

        const shift = shiftToViewportCenter(schematicsLink);
        schematicsLink.style.transform = `translateX(${shift}px)`;

        if (!schematicsPanel.hidden && schematicsPanel.style.maxHeight !== "none") {
          schematicsPanel.style.maxHeight = schematicsPanel.scrollHeight + "px";
        }
      });

      document.querySelectorAll(".schematics-list [data-dd]").forEach((btn) => {
        const key = btn.getAttribute("data-dd");
        const panel = document.getElementById(`dd-${key}`);

        btn.addEventListener("click", async (e) => {
          e.preventDefault();
          if (schematicsPanel.hidden) return;

          if (panel.hidden) {
            btn.classList.add("is-selected");
            await openPanel(panel);
          } else {
            await closePanel(panel);
            btn.classList.remove("is-selected");
          }
        });
      });
    </script>

  </div>
</body>
</html>
