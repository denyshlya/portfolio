<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Automotive Engine Rebuild | Denys Shlyakhtovskyy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/style.css">

  <style>
    .top-link{
      display: block;
      width: fit-content;
      margin: 14px 0 8px 0;
    }
    .content-center{
      text-align: center;
      margin-top: 8px;
    }
    .content-center .section-link{
      display: block;
      width: 100%;
      margin: 14px 0 8px 0;
    }
    .content-center .drop-panel{
      text-align: center;
      margin: 0 auto 8px auto;
      max-width: 70ch;
    }

    /* ===== PHOTO GRID ===== */
    .photo-grid-wrap{
      max-width: 1000px;
      margin: 0 auto;
    }

       
    .photo-grid{
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin: 10px auto 0;
      width: min(100%, 1000px);
    }
    
    .photo-grid > .photo-item{
      flex: 0 1 240px;    
      max-width: 320px;
    }

    .photo-item{
      margin: 0;
      border-radius: 12px;
      overflow: hidden;
      background: rgba(0,0,0,0.03);
      border: 1px solid rgba(0,0,0,0.10);
      cursor: pointer;
      position: relative;

      transform: translateZ(0);
      transition: transform 160ms ease;
    }

    .photo-item:hover{
      transform: scale(1.03);
    }

    .photo-item img{
      display: block;
      width: 100%;
      height: auto;
      aspect-ratio: 4 / 3;               
      object-fit: cover;                  
    }


    .photo-caption{
      margin: 12px auto 0;
      width: min(100%, 1000px);
      max-width: 70ch;
      text-align: center;
      opacity: 0.92;
      font-size: 0.95rem;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(0,0,0,0.03);
      border: 1px solid rgba(0,0,0,0.10);
      min-height: 44px; 
      display: flex;
      align-items: center;
      justify-content: center;
    }


      .img-overlay{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: grid;
      place-items: center;
      padding: 24px;
    
      background: transparent;   
      opacity: 0;
      pointer-events: none;
      transition: opacity 180ms ease;
    }
.img-overlay.is-open{
  opacity: 1;
  pointer-events: auto;
}

/* Expanded image container */
.img-overlay .stage-img{
  width: 100%;
  max-height: 72vh;
  border-radius: 14px;
  overflow: hidden;
  position: relative;

  background: transparent;
  border: 1px solid rgba(0,0,0,0.12);
}

/* Blurred background fill (so no black bars) */
.img-overlay .stage-img::before{
  content: "";
  position: absolute;
  inset: 0;
  background-image: var(--bg-img);
  background-size: cover;
  background-position: center;
  filter: blur(22px);
  transform: scale(1.15);
  opacity: 0.55;
}

/* Real image shows the full photo */
.img-overlay .stage-img img{
  position: relative;
  z-index: 1;
  width: 100%;
  height: 100%;
  object-fit: contain;     /* show everything */
  object-position: center;
  display: block;
  background: transparent;
}

.img-overlay .stage-caption{
  color: rgba(255,255,255,0.92);
  font-size: 0.95rem;
  text-align: center;
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.18);
}

 
    .img-clone{
      position: fixed;
      z-index: 10000;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
      will-change: transform, width, height, top, left;
      transition: transform 260ms cubic-bezier(.2,.8,.2,1),
                  width 260ms cubic-bezier(.2,.8,.2,1),
                  height 260ms cubic-bezier(.2,.8,.2,1),
                  top 260ms cubic-bezier(.2,.8,.2,1),
                  left 260ms cubic-bezier(.2,.8,.2,1);
    }
    .img-clone img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
  </style>
</head>

<body>
  <div class="container">
    <a class="back" href="/projects/">‚Üê Back to Projects</a>
    <h1>Automotive Engine Rebuild</h1>

    <p>
      I rebuilt a Hyundai 2.0 L engine, replacing the head gasket and valve stem seals along with the supporting components required to access and service the cylinder head. The project involved careful disassembly, cleaning, inspection, and reassembly of the engine to restore proper sealing, compression, and reliable operation.
    </p>

    <hr>

    <!-- OVERVIEW -->
    <section class="drop" data-drop>
      <a class="section-link top-link" href="#" data-drop-btn>Overview</a>

      <div class="drop-panel" hidden aria-hidden="true" data-drop-panel>
        <div class="drop-inner">
          <div class="content-center">
            <p>test</p>
          </div>
        </div>
      </div>
    </section>

    <!-- PHOTOS -->
    <section class="drop" data-drop>
      <a class="section-link top-link" href="#" data-drop-btn>Photos</a>

      <div class="drop-panel" hidden aria-hidden="true" data-drop-panel>
        <div class="drop-inner">
          <div class="content-center">

            <div class="photo-grid-wrap">
              <div class="photo-grid" data-photo-grid>
               
                <figure class="photo-item" data-photo-item data-caption="2016 Hyundai Elantra">
                  <img src="/assets/photos/hyundai/h1.jpg" alt="Photo 1">
                </figure>

                <figure class="photo-item" data-photo-item data-caption="2016 Hyundai Elantra">
                  <img src="/assets/photos/hyundai/h2.jpg" alt="Photo 2">
                </figure>

                <figure class="photo-item" data-photo-item data-caption="2016 Hyundai Elantra">
                  <img src="/assets/photos/hyundai/h3.jpg" alt="Photo 3">
                </figure>

                
                <figure class="photo-item" data-photo-item data-caption="Dissasembly Process">
                  <img src="/assets/photos/hyundai/h4.jpg" alt="Photo 4">
                </figure>

                
                <figure class="photo-item" data-photo-item data-caption="Prior to Dissasembly">
                  <img src="/assets/photos/hyundai/h5.jpg" alt="Photo 5">
                </figure>

                
                <figure class="photo-item" data-photo-item data-caption="Removing valve springs from cylinder head.">
                  <img src="/assets/photos/hyundai/h6.jpg" alt="Photo 6">
                </figure>
                <!-- ...more photos -->
              </div>

              
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- Overlay for expanded image -->
    <div class="img-overlay" data-img-overlay aria-hidden="true">
      <div class="stage">
        <div class="stage-img">
          <img data-overlay-img src="" alt="">
        </div>
        <div class="stage-caption" data-overlay-caption></div>
      </div>
    </div>

    <!-- ===== Script (dropdown behavior + photo grid interactions) ===== -->
    <script>
      /* ===== existing dropdown script (unchanged) ===== */
      function shiftToViewportCenter(el){
        const r = el.getBoundingClientRect();
        const elCenter = r.left + r.width / 2;
        const viewportCenter = window.innerWidth / 2;
        return viewportCenter - elCenter;
      }

      function waitForTransition(el, prop){
        return new Promise((resolve) => {
          const onEnd = (e) => {
            if (e.propertyName !== prop) return;
            el.removeEventListener("transitionend", onEnd);
            resolve();
          };
          el.addEventListener("transitionend", onEnd);
        });
      }

      async function openPanel(panel){
        panel.hidden = false;
        panel.setAttribute("aria-hidden", "false");

        panel.style.maxHeight = "0px";
        panel.getBoundingClientRect();

        panel.classList.add("is-open");
        panel.style.maxHeight = panel.scrollHeight + "px";

        await waitForTransition(panel, "max-height");
        panel.style.maxHeight = "none";
      }

      async function closePanel(panel){
        panel.style.maxHeight = panel.scrollHeight + "px";
        panel.getBoundingClientRect();

        panel.classList.remove("is-open");
        panel.style.maxHeight = "0px";

        await waitForTransition(panel, "max-height");

        panel.hidden = true;
        panel.setAttribute("aria-hidden", "true");
      }

      function hardCloseInside(root){
        root.querySelectorAll(".drop-panel").forEach((p) => {
          p.classList.remove("is-open");
          p.style.maxHeight = "0px";
          p.hidden = true;
          p.setAttribute("aria-hidden", "true");
        });
        root.querySelectorAll(".section-link").forEach((a) => a.classList.remove("is-selected"));
      }

      document.querySelectorAll("[data-drop]").forEach((drop) => {
        const topBtn = drop.querySelector("[data-drop-btn]");
        const topPanel = drop.querySelector("[data-drop-panel]");
        if (!topBtn || !topPanel) return;

        let open = false;
        let sliding = false;

        async function slideToCenter(){
          if (sliding) return;
          sliding = true;

          topBtn.style.transform = "translateX(0px)";
          topBtn.getBoundingClientRect();

          requestAnimationFrame(() => {
            const shift = shiftToViewportCenter(topBtn);
            topBtn.style.transform = `translateX(${shift}px)`;
          });

          await waitForTransition(topBtn, "transform");
          sliding = false;
        }

        async function slideBackLeft(){
          if (sliding) return;
          sliding = true;

          topBtn.style.transform = "translateX(0px)";
          await waitForTransition(topBtn, "transform");

          sliding = false;
        }

        topBtn.addEventListener("click", async (e) => {
          e.preventDefault();
          if (sliding) return;

          open = !open;

          if (open){
            topBtn.classList.add("is-selected");
            await slideToCenter();
            await openPanel(topPanel);
          } else {
            hardCloseInside(topPanel);
            await closePanel(topPanel);
            topBtn.classList.remove("is-selected");
            await slideBackLeft();
          }
        });

        // nested panels inside THIS dropdown
        drop.querySelectorAll("[data-sub-btn]").forEach((btn) => {
          const key = btn.getAttribute("data-sub-btn");
          const panel = drop.querySelector(`[data-sub-panel="${key}"]`);
          if (!panel) return;

          btn.addEventListener("click", async (e) => {
            e.preventDefault();
            if (topPanel.hidden) return;

            if (panel.hidden){
              btn.classList.add("is-selected");
              await openPanel(panel);
            } else {
              await closePanel(panel);
              btn.classList.remove("is-selected");
            }
          });
        });

        // keep centered & heights correct on resize
        window.addEventListener("resize", () => {
          if (!open) return;

          topBtn.style.transform = `translateX(${shiftToViewportCenter(topBtn)}px)`;
          if (!topPanel.hidden && topPanel.style.maxHeight !== "none"){
            topPanel.style.maxHeight = topPanel.scrollHeight + "px";
          }
        });
      });

      /* ===== PHOTO GRID INTERACTIONS ===== */
      (function initPhotoGrid(){
        const grid = document.querySelector("[data-photo-grid]");
        if (!grid) return;

        const captionBar = document.querySelector("[data-photo-caption]");
        const overlay = document.querySelector("[data-img-overlay]");
        const overlayImg = document.querySelector("[data-overlay-img]");
        const overlayCaption = document.querySelector("[data-overlay-caption]");

        let activeItem = null;
        let animating = false;

        function setCaption(text){
          if (!captionBar) return;
          captionBar.textContent = text || "";
        }

        grid.querySelectorAll("[data-photo-item]").forEach((item) => {
          const cap = item.getAttribute("data-caption") || "";
          item.addEventListener("mouseenter", () => setCaption(cap));
          item.addEventListener("mouseleave", () => setCaption("Hover a photo for a closer look. Click to expand."));
        });

        function rectToBox(r){
          return { top: r.top, left: r.left, width: r.width, height: r.height };
        }

        function placeCloneFromRect(clone, box){
          clone.style.top = box.top + "px";
          clone.style.left = box.left + "px";
          clone.style.width = box.width + "px";
          clone.style.height = box.height + "px";
          clone.style.transform = "translateZ(0)";
        }

        async function flipOpen(item){
          if (animating) return;
          animating = true;
          activeItem = item;

          const img = item.querySelector("img");
          const src = img?.getAttribute("src") || "";
          const alt = img?.getAttribute("alt") || "";
          const cap = item.getAttribute("data-caption") || "";

          // get start rect (grid image)
          const startRect = img.getBoundingClientRect();
          const startBox = rectToBox(startRect);

          // prepare overlay content (but keep overlay transparent until after clone starts moving)
          overlayImg.src = src;
          overlayImg.alt = alt;
          overlayCaption.textContent = cap;

          // create clone
          const clone = document.createElement("div");
          clone.className = "img-clone";
          clone.innerHTML = `<img src="${src}" alt="">`;
          document.body.appendChild(clone);

          placeCloneFromRect(clone, startBox);

          // open overlay (for final target size measurement)
          overlay.classList.add("is-open");
          overlay.setAttribute("aria-hidden", "false");

          // force layout so overlay is measurable
          overlay.getBoundingClientRect();

          // target rect = overlay image container (stage-img)
          const targetEl = overlay.querySelector(".stage-img");
          const targetRect = targetEl.getBoundingClientRect();
          const targetBox = rectToBox(targetRect);

          // animate clone to target
          requestAnimationFrame(() => {
            clone.style.top = targetBox.top + "px";
            clone.style.left = targetBox.left + "px";
            clone.style.width = targetBox.width + "px";
            clone.style.height = targetBox.height + "px";
            clone.querySelector("img").style.objectFit = "cover";
          });

          // wait transition end
          await new Promise((res) => setTimeout(res, 280));

          // remove clone, show overlay content fully
          clone.remove();
          animating = false;
        }

        async function flipClose(){
          if (!activeItem || animating) return;
          animating = true;

          const item = activeItem;
          const img = item.querySelector("img");
          const src = img?.getAttribute("src") || "";
          const cap = item.getAttribute("data-caption") || "";

          // start rect = overlay stage-img
          const startEl = overlay.querySelector(".stage-img");
          const startRect = startEl.getBoundingClientRect();
          const startBox = rectToBox(startRect);

          // end rect = grid image
          const endRect = img.getBoundingClientRect();
          const endBox = rectToBox(endRect);

          // create clone at overlay size
          const clone = document.createElement("div");
          clone.className = "img-clone";
          clone.innerHTML = `<img src="${src}" alt="">`;
          document.body.appendChild(clone);

          placeCloneFromRect(clone, startBox);

          // hide overlay (fade) while clone animates back
          overlay.classList.remove("is-open");
          overlay.setAttribute("aria-hidden", "true");

          requestAnimationFrame(() => {
            clone.style.top = endBox.top + "px";
            clone.style.left = endBox.left + "px";
            clone.style.width = endBox.width + "px";
            clone.style.height = endBox.height + "px";
          });

          await new Promise((res) => setTimeout(res, 280));
          clone.remove();

          activeItem = null;
          animating = false;

          setCaption(cap ? cap : "Hover a photo for a closer look. Click to expand.");
        }

        // click on any photo toggles open (or closes if it's already open)
        grid.addEventListener("click", (e) => {
          const item = e.target.closest("[data-photo-item]");
          if (!item) return;

          if (activeItem && item === activeItem){
            flipClose();
          } else if (!activeItem){
            flipOpen(item);
          } else {
            // if another is open, close then open new (simple/clean)
            flipClose().then(() => flipOpen(item));
          }
        });

        // click outside image closes
        overlay.addEventListener("click", (e) => {
          // allow clicking anywhere to close
          flipClose();
        });

        // escape closes
        window.addEventListener("keydown", (e) => {
          if (e.key === "Escape") flipClose();
        });

        // keep animation targets sane on resize
        window.addEventListener("resize", () => {
          if (!activeItem) return;
          // no live resizing while open; overlay handles responsive layout
        });
      })();
    </script>
  </div>
</body>
</html>
